# Research: Автоматический подсчёт веса

## R-001: Идентификация пользователя для хранения 1ПМ

**Decision**: Использовать `telegram_id` (число) из `X-Telegram-Init-Data` заголовка как ключ пользователя в модели OneRepMax.

**Rationale**: В проекте уже есть `TelegramInitDataAuthentication` в `backend/programs/authentication.py`, который парсит и валидирует `initData` из Telegram. Из него извлекается `user.id` (Telegram user ID). Нет Django User модели — и создавать её не нужно: достаточно хранить `telegram_id` как числовое поле в OneRepMax.

**Alternatives considered**:
- Создание полноценной Django User модели — overengineering для одного поля 1ПМ
- Хранение на клиенте в Zustand — не привязано к аккаунту, теряется при смене устройства

## R-002: Структура API для 1ПМ

**Decision**: Один эндпоинт `GET/PUT /api/one-rep-max/` — возвращает и обновляет 1ПМ текущего пользователя (определяется по Telegram initData). Не REST-коллекция, а singleton-ресурс.

**Rationale**: У пользователя ровно один набор 1ПМ (bench, squat, deadlift). Нет смысла в CRUD-коллекции. GET возвращает текущие значения (или значения по умолчанию 0), PUT обновляет. Telegram user_id извлекается из заголовка аутентификации.

**Alternatives considered**:
- Отдельные эндпоинты для каждого движения — избыточно, всегда работаем с тройкой
- POST для создания + PUT для обновления — get_or_create в PUT упрощает до одного метода

## R-003: Расчёт веса — бэкенд vs фронтенд

**Decision**: Расчёт на фронтенде. Бэкенд только хранит 1ПМ, фронтенд вычисляет `floor(1ПМ × percent / 100 / 2.5) * 2.5` на лету.

**Rationale**:
- Расчёт тривиальный (одна формула), нет смысла делать серверный
- Фронтенд уже имеет все данные: load_value (процент) из API недель + 1ПМ из нового API
- Мгновенный пересчёт при изменении 1ПМ без дополнительных запросов (FR-009)

**Alternatives considered**:
- Бэкенд рассчитывает и возвращает вес в API недель — создаёт связность, сложнее для мгновенного пересчёта

## R-004: Компонент сайдбара

**Decision**: shadcn Sheet (slide-out panel) с кнопкой-триггером на основной странице.

**Rationale**: Sheet из shadcn/ui — готовый компонент бокового меню. Подходит для mobile-first Telegram Mini App. Кнопка с иконкой Menu в верхнем левом углу страницы.

**Alternatives considered**:
- shadcn Drawer — больше подходит для bottom-sheet на мобильных, но сайдбар привычнее для навигации
- Отдельная страница (роутинг) — оверинжиниринг для одной страницы настроек
