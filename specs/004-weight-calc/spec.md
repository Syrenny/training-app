# Feature Specification: Автоматический подсчёт веса

**Feature Branch**: `004-weight-calc`
**Created**: 2026-02-25
**Status**: Draft
**Input**: User description: "Автоматический подсчет веса на подходе: ввод 1ПМ, расчет процентов с округлением до 2.5кг"

## User Scenarios & Testing *(mandatory)*

### User Story 1 — Ввод разовых максимумов (Priority: P1)

Пользователь открывает боковое меню (сайдбар), переходит на страницу ввода 1ПМ и вводит свои разовые максимумы для трёх движений: жим лёжа, приседания, становая тяга. Значения сохраняются между сессиями. Ввод ограничен числами, максимум 3 цифры (до 999 кг).

**Why this priority**: Без введённых 1ПМ расчёт процентов невозможен. Это фундамент для всей фичи.

**Independent Test**: Открыть сайдбар → перейти на страницу 1ПМ → ввести значения → закрыть и открыть приложение → значения сохранены.

**Acceptance Scenarios**:

1. **Given** пользователь открыл сайдбар, **When** он нажимает на пункт "1ПМ", **Then** открывается страница с тремя полями ввода (жим, присед, тяга)
2. **Given** поле ввода 1ПМ, **When** пользователь вводит число, **Then** допускаются только цифры, максимум 3 символа
3. **Given** пользователь ввёл значения 1ПМ, **When** он закрывает и открывает приложение, **Then** значения сохранены
4. **Given** поле ввода 1ПМ, **When** пользователь пытается ввести буквы или спецсимволы, **Then** ввод игнорируется

---

### User Story 2 — Отображение рассчитанного веса (Priority: P1)

Пользователь просматривает программу тренировок. Для каждого подхода, где указан процент от максимума, рядом отображается рассчитанный вес в килограммах. Вес рассчитывается как процент от соответствующего 1ПМ (жим → 1ПМ жима, присед → 1ПМ приседа, тяга → 1ПМ тяги), округлённый вниз до ближайшего числа, кратного 2.5 кг.

**Why this priority**: Это основная ценность фичи — пользователь видит конкретный вес, который нужно повесить на штангу.

**Independent Test**: Ввести 1ПМ жима = 100 кг → открыть неделю с жимом → подход 70% показывает "70 кг", подход 75% показывает "75 кг", подход 72% показывает "70 кг" (72 → округление вниз до 2.5).

**Acceptance Scenarios**:

1. **Given** 1ПМ жима = 100 кг, **When** отображается подход с 70%, **Then** рядом с "70%" показано "70 кг"
2. **Given** 1ПМ приседа = 150 кг, **When** отображается подход с 80%, **Then** рядом показано "120 кг" (150 × 0.8 = 120)
3. **Given** 1ПМ тяги = 200 кг, **When** отображается подход с 72%, **Then** рядом показано "142.5 кг" (200 × 0.72 = 144 → округление вниз до 142.5)
4. **Given** 1ПМ не введён для данного движения, **When** отображается подход с процентом, **Then** рассчитанный вес не показывается (отображается только процент)
5. **Given** 1ПМ = 90 кг, **When** подход 55%, **Then** рядом показано "47.5 кг" (90 × 0.55 = 49.5 → округление вниз до 47.5)

---

### Edge Cases

- Что если 1ПМ = 0 или пустое? Рассчитанный вес не отображается, показывается только процент.
- Что если процент даёт вес меньше 2.5 кг? Показывается 0 кг.
- Что если пользователь изменил 1ПМ? Все отображаемые веса пересчитываются мгновенно.
- Что если упражнение категории ACCESSORY имеет процентные подходы? Расчёт не производится — подсобные упражнения не привязаны к 1ПМ.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система MUST предоставлять страницу ввода 1ПМ, доступную из бокового меню
- **FR-002**: Система MUST иметь три поля ввода: жим лёжа, приседания, становая тяга
- **FR-003**: Поля ввода MUST принимать только цифры, максимум 3 символа (до 999)
- **FR-004**: Система MUST сохранять значения 1ПМ на сервере, привязывая к Telegram-аккаунту пользователя
- **FR-005**: Система MUST рассчитывать вес как: (1ПМ × процент / 100), округлённый вниз до кратного 2.5 кг
- **FR-006**: Система MUST отображать рассчитанный вес рядом с процентом в каждом подходе
- **FR-007**: Система MUST сопоставлять категорию упражнения (BENCH/SQUAT/DEADLIFT) с соответствующим 1ПМ
- **FR-008**: Система MUST НЕ отображать рассчитанный вес, если 1ПМ для данного движения не введён
- **FR-009**: Система MUST мгновенно пересчитывать все веса при изменении 1ПМ

### Key Entities

- **1ПМ (One Rep Max)**: Максимальный вес на одно повторение для трёх базовых движений (жим, присед, тяга). Хранится на бэкенде, привязан к Telegram-аккаунту пользователя. Числовое значение 1-999.
- **Рассчитанный вес**: Производное значение = floor(1ПМ × процент / 100, шаг 2.5). Не хранится, вычисляется на лету.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Пользователь может ввести 1ПМ для всех трёх движений менее чем за 30 секунд
- **SC-002**: Рассчитанный вес отображается корректно для 100% подходов с процентной нагрузкой (при введённом 1ПМ)
- **SC-003**: Округление вниз до 2.5 кг работает корректно для всех значений
- **SC-004**: После перезапуска приложения значения 1ПМ сохранены и веса отображаются без повторного ввода

## Clarifications

### Session 2026-02-25

- Q: Как отображать рассчитанный вес рядом с процентом? → A: Внутри бейджа подхода рядом с процентом (например, `70% (70кг) ×4×2`)
- Q: Где хранить 1ПМ? → A: На бэкенде, привязан к Telegram-аккаунту пользователя (не на клиенте)

## Assumptions

- 1ПМ хранится на бэкенде, привязан к Telegram-аккаунту пользователя (требуется API-эндпоинт для чтения/записи)
- Подсобные упражнения (ACCESSORY) никогда не используют процентную нагрузку от 1ПМ
- Формула округления: Math.floor(вес / 2.5) * 2.5
- Сайдбар реализуется с помощью компонента из shadcn/ui
