from django.core.management.base import BaseCommand

from programs.models import (
    Day,
    DayExercise,
    Exercise,
    ExerciseCategory,
    ExerciseSet,
    LoadType,
    Week,
)

# Shorthand aliases
P = LoadType.PERCENT
I = LoadType.INDIVIDUAL
BW = LoadType.BODYWEIGHT
S = ExerciseCategory.SQUAT
B = ExerciseCategory.BENCH
D = ExerciseCategory.DEADLIFT
A = ExerciseCategory.ACCESSORY

# fmt: off
WEEK_1 = {
    "MON": [
        ("Приседания", S, [(P,50,6,1),(P,60,5,1),(P,70,4,1),(P,75,4,4)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,5,1),(P,70,4,1),(P,75,3,5)]),
        ("Разводка лёжа на скамье", A, [(I,None,10,3)]),
        ("Приседания в глубину", S, [(I,None,10,2),(I,None,6,4)]),
        ("Гиперэкстензия", A, [(I,None,12,3)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Приседания в глубину", S, [(I,None,8,1),(I,None,5,3)]),
        ("Жим штанги стоя", B, [(P,20,8,1),(P,25,6,2),(P,30,5,3)]),
        ("Становая тяга", D, [(P,50,8,1),(P,60,6,1),(P,75,6,4)]),
        ("Пресс с весом", A, [(I,None,20,4)]),
        ("Гиперэкстензия", A, [(BW,None,15,4)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,10,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,6,1),(P,60,5,1),(P,70,4,2),(P,75,3,5)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,6,1),(P,70,6,1),(P,75,5,3)]),
        ("Приседания", S, [(P,60,6,4)]),
        ("Разводка лёжа на скамье", A, [(I,None,10,3)]),
        ("Пресс", A, [(I,None,20,4)]),
        ("Подъём штанги на бицепс", A, [(I,None,10,3)]),
    ],
}

WEEK_2 = {
    "MON": [
        ("Жим лёжа", B, [(P,50,6,1),(P,60,6,1),(P,70,4,2),(P,80,3,5)]),
        ("Приседания", S, [(P,50,6,1),(P,60,6,1),(P,70,3,2),(P,80,2,4)]),
        ("Жим лежа узким хватом", B, [(P,55,5,5)]),
        ("Подъём штанги на бицепс", A, [(I,None,6,5)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Приседания в глубину", S, [(I,None,6,1),(I,None,6,1),(I,None,5,5)]),
        ("Становая тяга", D, [(P,50,6,1),(P,60,6,1),(P,70,5,4)]),
        ("Жим штанги сидя", B, [(P,50,4,5)]),
        ("Мертвая тяга", D, [(P,65,6,4)]),
        ("Гиперэкстензия", A, [(I,None,8,4)]),
        ("Подтягивания узким хватом", A, [(I,None,6,1)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,6,1),(P,60,6,1),(P,70,4,2),(P,80,3,5)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,5,1),(P,70,3,2),(P,80,3,5)]),
        ("Разводка лёжа на скамье", A, [(I,None,8,3)]),
        ("Жим гантелей лежа", A, [(I,None,6,4)]),
        ("Приседания в глубину", S, [(I,None,8,3)]),
        ("Молотки", A, [(I,None,10,3)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_3 = {
    "MON": [
        ("Приседания", S, [(P,50,5,1),(P,60,5,1),(P,70,3,2),(P,80,2,2),(P,85,2,5)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,5,1),(P,70,3,2),(P,80,3,1),(P,85,2,5)]),
        ("Разводка лёжа на скамье", A, [(I,None,8,3)]),
        ("Приседания в глубину", S, [(P,45,6,5)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,8,3)]),
        ("Подъём штанги на бицепс прямой хват", A, [(I,None,8,4)]),
        ("Подъём штанги на бицепс обратный хват", A, [(I,None,8,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,6,1),(P,60,6,1),(P,70,6,1),(P,80,4,4)]),
        ("Жим лёжа", B, [(P,40,5,3)]),
        ("Тяга верхнего блока к груди", A, [(I,None,10,4)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,10,4)]),
        ("Гиперэкстензия", A, [(I,None,8,3)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,6,1),(P,60,6,1),(P,75,3,1),(P,75,5,1),(P,75,7,1),(P,75,9,1),(P,75,8,1),(P,75,6,1),(P,75,4,1)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,5,1),(P,70,5,5)]),
        ("Разводка лёжа на скамье", A, [(I,None,6,3)]),
        ("Жим лежа средний хват", B, [(P,60,5,3)]),
        ("Наклоны с гантелью", S, [(P,40,5,4)]),
        ("Молотки", A, [(I,None,6,3)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_4 = {
    "MON": [
        ("Приседания", S, [(P,50,5,1),(P,60,5,1),(P,70,3,2),(P,75,3,1),(P,80,2,1),(P,85,2,2),(P,80,2,2)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,6,1),(P,70,5,2),(P,80,3,1),(P,82.5,3,1),(P,85,2,3)]),
        ("Приседания", S, [(P,60,6,4)]),
        ("Жим гантелей лежа", A, [(I,None,8,4)]),
        ("Подъём штанги на бицепс", A, [(I,None,8,5)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,6,1),(P,60,5,1),(P,70,3,2),(P,80,2,5)]),
        ("Жим гантелей скамья 30°", B, [(P,60,4,6)]),
        ("Тяга с плинтов", D, [(P,60,5,1),(P,70,5,1),(P,80,4,1),(P,85,3,1),(P,90,3,2)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,5,1),(P,70,4,4)]),
        ("Разгибание бедра в тренажере", A, [(I,None,10,5)]),
        ("Подтягивания широкий хват", A, [(I,None,5,1)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Жим лёжа", B, [(P,50,5,1),(P,60,5,1),(P,70,3,2),(P,75,3,5)]),
        ("Приседания", S, [(P,50,5,1),(P,60,5,1),(P,70,3,2),(P,75,3,5)]),
        ("Негативный жим", B, [(P,60,5,1),(P,70,5,1),(P,85,3,3)]),
        ("Разводка лёжа на скамье", A, [(I,None,8,3)]),
        ("Сгибания на бицепс обратным хватом", A, [(I,None,8,4)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,8,4)]),
    ],
}

WEEK_5 = {
    "MON": [
        ("Приседания", S, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,2,6)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,5,1),(P,70,3,2),(P,80,3,6)]),
        ("Разводка гантелей лёжа", A, [(I,None,8,4)]),
        ("Приседания в глубину", S, [(P,45,6,5)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,55,5,1),(P,60,5,1),(P,65,5,1),(P,70,5,1),(P,75,5,1)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,10,4)]),
        ("Подъём штанги на бицепс", A, [(I,None,10,5)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,6,1),(P,60,6,1),(P,70,5,1),(P,75,4,4)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,5,1),(P,65,5,1),(P,70,4,1),(P,75,3,1),(P,80,3,1),(P,75,3,1),(P,70,4,1),(P,65,5,1),(P,60,6,1),(P,55,7,1),(P,50,8,1)]),
        ("Разводка гантелей лёжа", A, [(I,None,10,3)]),
        ("Тяга с плинтов", D, [(P,60,6,1),(P,70,6,1),(P,80,5,1),(P,90,4,4)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,8,4)]),
        ("Подтягивания узким хватом", A, [(I,None,8,5)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,6,1),(P,60,5,1),(P,70,3,2),(P,80,2,5)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,5,1),(P,70,4,2),(P,80,3,5)]),
        ("Разводка гантелей лёжа", A, [(I,None,10,3)]),
        ("Приседания", S, [(P,60,5,1),(P,65,5,1),(P,75,4,4)]),
        ("Гиперэкстензия", A, [(I,None,12,4)]),
        ("Сгибания на бицепс обратным хватом", A, [(I,None,6,6)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_6 = {
    "MON": [
        ("Приседания", S, [(P,50,6,1),(P,60,5,1),(P,70,3,2),(P,80,2,7)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,6,1),(P,70,4,2),(P,80,3,1),(P,85,2,2),(P,80,3,2)]),
        ("Разводка скамья 30°", A, [(I,None,6,4)]),
        ("Жим лежа средний хват", B, [(P,50,5,1),(P,60,5,1),(P,65,5,1),(P,70,5,1),(P,75,5,1)]),
        ("Подъём штанги на бицепс прямой хват", A, [(I,None,6,4)]),
        ("Подъём штанги на бицепс обратный хват", A, [(I,None,6,4)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,6,1),(P,60,6,1),(P,70,5,1),(P,80,4,4)]),
        ("Жим гантелей скамья 30°", B, [(P,50,5,1),(P,55,5,1),(P,60,5,1),(P,65,5,4)]),
        ("Тяга с плинтов", D, [(P,60,6,1),(P,70,5,1),(P,80,4,1),(P,90,4,4)]),
        ("Тяга верхнего блока к груди", A, [(I,None,10,1),(I,None,8,5)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,10,1),(I,None,8,5)]),
        ("Гиперэкстензия", A, [(I,None,20,2)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,4,1),(P,60,4,1),(P,75,5,1),(P,75,7,1),(P,75,9,1),(P,75,8,1),(P,75,6,1),(P,75,4,1)]),
        ("Жим лёжа", B, [(P,50,6,1),(P,60,5,1),(P,65,5,1),(P,70,5,1),(P,75,5,1),(P,80,5,2)]),
        ("Разводка лёжа на скамье", A, [(I,None,6,3)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,6,5)]),
        ("Сгибания на бицепс обратным хватом", A, [(I,None,8,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_7 = {
    "MON": [
        ("Приседания", S, [(P,50,5,1),(P,60,5,1),(P,70,3,2),(P,80,3,2),(P,85,2,2),(P,80,3,2)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,3,2),(P,85,2,2),(P,80,3,2)]),
        ("Разводка лёжа на скамье", A, [(I,None,6,5)]),
        ("Полуприсед", S, [(P,60,5,1),(P,70,5,1),(P,80,5,1),(P,85,5,1),(P,95,4,4)]),
        ("Жим лежа средний хват", B, [(P,50,6,1),(P,60,5,1),(P,75,5,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Становая тяга с подставками", D, [(P,50,6,1),(P,55,5,1),(P,60,4,4)]),
        ("Жим штанги лежа на скамье 30°", B, [(P,50,6,1),(P,60,5,1),(P,65,5,1),(P,70,5,3)]),
        ("Тяга с плинтов", D, [(P,60,6,1),(P,75,5,1),(P,80,4,1),(P,95,3,3)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,10,3)]),
        ("Гиперэкстензия", A, [(I,None,8,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,6,1),(P,60,5,1),(P,70,4,2),(P,75,4,1),(P,85,3,2),(P,80,3,2)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,3,1),(P,85,2,2),(P,90,1,2),(P,85,2,1)]),
        ("Разводка лёжа на скамье", A, [(I,None,6,5)]),
        ("Приседания", S, [(P,70,5,5)]),
        ("Жим гантелей лежа", A, [(I,None,5,5)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,8,6)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_8 = {
    "MON": [
        ("Приседания", S, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,3,2),(P,85,2,1),(P,90,1,2),(P,85,2,2)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,70,4,1),(P,80,3,2),(P,85,2,3),(P,90,2,1)]),
        ("Разводка лёжа на скамье", A, [(I,None,8,3)]),
        ("Полуприсед", S, [(P,50,5,1),(P,75,4,1),(P,90,3,3)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,8,4)]),
        ("Подъём штанги на бицепс", A, [(I,None,8,5)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,6,1),(P,60,6,1),(P,70,6,1),(P,75,6,3)]),
        ("Жим штанги лежа на скамье 30°", B, [(P,50,6,1),(P,60,5,1),(P,65,5,3)]),
        ("Мертвая тяга", D, [(P,50,6,1),(P,65,5,5)]),
        ("Жим лежа узким хватом", B, [(P,65,6,4)]),
        ("Подтягивания узким хватом", A, [(BW,None,10,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,5,1),(P,60,5,1),(P,70,5,1),(P,80,5,3)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,5,1),(P,70,4,1),(P,80,4,4)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,8,5)]),
        ("Разводка лёжа на скамье", A, [(I,None,10,4)]),
        ("Молотки", A, [(I,None,10,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_9 = {
    "MON": [
        ("Приседания", S, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,3,1),(P,90,2,2)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,55,5,1),(P,60,6,1),(P,65,5,1),(P,70,5,1),(P,75,4,1),(P,80,3,1),(P,82,3,1),(P,85,2,1),(P,80,4,1),(P,75,5,1),(P,70,6,1),(P,65,7,1),(P,60,8,1)]),
        ("Разводка лёжа на скамье", A, [(I,None,10,3)]),
        ("Приседания", S, [(P,60,5,1),(P,75,5,5)]),
        ("Гиперэкстензия", A, [(I,None,6,5)]),
        ("Подъём штанги на бицепс", A, [(I,None,12,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,6,1),(P,60,6,1),(P,70,5,1),(P,80,4,1),(P,85,3,5)]),
        ("Жим штанги лежа на скамье 30°", B, [(P,50,5,1),(P,60,5,1),(P,65,4,1),(P,70,4,1),(P,75,4,2)]),
        ("Приседания в глубину", S, [(P,30,8,3)]),
        ("Горизонтальная тяга блока к поясу", A, [(I,None,10,4)]),
        ("Тяга верхнего блока к груди", A, [(I,None,8,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,3,6)]),
        ("Жим лёжа", B, [(P,50,5,1),(P,60,4,1),(P,70,3,2),(P,80,3,2),(P,85,2,3)]),
        ("Разводка лёжа на скамье", A, [(I,None,8,4)]),
        ("Негативный жим", B, [(P,70,4,1),(P,90,2,1),(P,100,2,3),(P,110,1,1)]),
        ("Наклоны", S, [(P,40,5,5)]),
        ("Молотки", A, [(I,None,10,5)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
}

WEEK_10 = {
    "MON": [
        ("Приседания", S, [(P,50,4,1),(P,55,4,1),(P,60,4,1),(P,65,4,1),(P,70,4,2)]),
        ("Жим лёжа", B, [(P,50,4,1),(P,55,4,1),(P,60,4,1),(P,65,4,1),(P,70,4,3)]),
        ("Разводка лёжа на скамье", A, [(I,None,5,3)]),
        ("Разгибания на трицепс в блоке", A, [(I,None,6,4)]),
        ("Подъём штанги на бицепс", A, [(I,None,8,4)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "WED": [
        ("Становая тяга", D, [(P,50,5,1),(P,60,3,1),(P,70,2,1),(P,75,2,4)]),
        ("Жим штанги лежа на скамье 30°", B, [(P,50,5,1),(P,55,5,1),(P,60,4,4)]),
        ("Тяга верхнего блока к груди", A, [(I,None,8,3)]),
        ("Пресс", A, [(I,None,20,4)]),
    ],
    "FRI": [
        ("Приседания", S, [(P,65,4,3)]),
        ("Жим лёжа", B, [(P,60,4,4)]),
    ],
}
# fmt: on

ALL_WEEKS = {
    1: ("1 неделя", WEEK_1),
    2: ("2 неделя", WEEK_2),
    3: ("3 неделя", WEEK_3),
    4: ("4 неделя", WEEK_4),
    5: ("5 неделя", WEEK_5),
    6: ("6 неделя", WEEK_6),
    7: ("7 неделя", WEEK_7),
    8: ("8 неделя", WEEK_8),
    9: ("9 неделя", WEEK_9),
    10: ("10 неделя", WEEK_10),
}

WEEKDAY_ORDER = {"MON": 1, "WED": 2, "FRI": 3}


class Command(BaseCommand):
    help = "Seed the database with the full 10-week training program from PDF reference"

    def add_arguments(self, parser):
        parser.add_argument(
            "--force",
            action="store_true",
            help="Delete existing data and re-seed all weeks",
        )

    def handle(self, *args, **options):
        if options["force"]:
            self.stdout.write(
                self.style.WARNING("Deleting all existing program data...")
            )
            Week.objects.all().delete()

        created_count = 0
        skipped_count = 0

        for week_number, (title, days_data) in ALL_WEEKS.items():
            week, created = Week.objects.get_or_create(
                number=week_number, defaults={"title": title}
            )
            if not created:
                self.stdout.write(f"  Week {week_number} already exists, skipping")
                skipped_count += 1
                continue

            for weekday_code, exercises_data in days_data.items():
                day = Day.objects.create(
                    week=week,
                    weekday=weekday_code,
                    order=WEEKDAY_ORDER[weekday_code],
                )

                for ex_order, (ex_name, ex_category, sets_data) in enumerate(
                    exercises_data, start=1
                ):
                    exercise, _ = Exercise.objects.get_or_create(
                        name=ex_name, defaults={"category": ex_category}
                    )
                    day_exercise = DayExercise.objects.create(
                        day=day, exercise=exercise, order=ex_order
                    )

                    for set_order, (load_type, load_value, reps, sets) in enumerate(
                        sets_data, start=1
                    ):
                        ExerciseSet.objects.create(
                            day_exercise=day_exercise,
                            load_type=load_type,
                            load_value=load_value,
                            reps=reps,
                            sets=sets,
                            order=set_order,
                        )

            created_count += 1
            self.stdout.write(f"  Week {week_number} created")

        self.stdout.write(
            self.style.SUCCESS(
                f"Done: {created_count} weeks created, {skipped_count} skipped"
            )
        )
